# Casbin RBAC model for Chive authorization
#
# This model implements hierarchical RBAC with resource ownership
# and scope-based permissions for the Chive preprint service.

[request_definition]
r = sub, obj, act

[policy_definition]
p = sub, obj, act

[role_definition]
# g = user, role
# g2 = role, role (for role hierarchy)
g = _, _
g2 = _, _

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
# Match if:
# 1. User has direct permission (p.sub == r.sub && p.obj == r.obj && p.act == r.act)
# 2. User has role with permission (g(r.sub, p.sub) && p.obj == r.obj && p.act == r.act)
# 3. Role hierarchy grants permission (g2(p.sub, assigned_role))
# 4. Wildcard object match (p.obj == "*")
# 5. Wildcard action match (p.act == "*")
m = g(r.sub, p.sub) && (p.obj == r.obj || p.obj == "*") && (p.act == r.act || p.act == "*")
