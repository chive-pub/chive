# External Secrets Operator Configuration
# Use this when integrating with HashiCorp Vault, AWS Secrets Manager, etc.
#
# Prerequisites:
# 1. Install External Secrets Operator: https://external-secrets.io/
# 2. Configure SecretStore for your provider (Vault, AWS, etc.)
---
# Example: SecretStore for HashiCorp Vault
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: vault-backend
  namespace: chive
spec:
  provider:
    vault:
      server: "https://vault.example.com"
      path: "secret"
      version: "v2"
      auth:
        kubernetes:
          mountPath: "kubernetes"
          role: "chive"
          serviceAccountRef:
            name: "chive-appview"
---
# ExternalSecret to sync Chive secrets from Vault
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: chive-secrets
  namespace: chive
  labels:
    app.kubernetes.io/name: chive
    app.kubernetes.io/part-of: chive
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault-backend
    kind: SecretStore
  target:
    name: chive-secrets
    creationPolicy: Owner
  data:
    - secretKey: POSTGRES_PASSWORD
      remoteRef:
        key: secret/data/chive/database
        property: postgres_password
    - secretKey: NEO4J_AUTH
      remoteRef:
        key: secret/data/chive/database
        property: neo4j_auth
    - secretKey: JWT_SECRET
      remoteRef:
        key: secret/data/chive/security
        property: jwt_secret
    - secretKey: SESSION_SECRET
      remoteRef:
        key: secret/data/chive/security
        property: session_secret
