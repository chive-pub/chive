# =============================================================================
# Chive Production Environment Configuration
# =============================================================================
# Copy this file to .env.production and fill in your values
# NEVER commit .env.production to version control
# =============================================================================

# -----------------------------------------------------------------------------
# Domain Configuration
# -----------------------------------------------------------------------------
# Your domain name (required for SSL certificates)
DOMAIN=chive.example.com

# Email for Let's Encrypt SSL certificates
ACME_EMAIL=admin@example.com

# Traefik dashboard authentication (generate with: htpasswd -nb admin password)
TRAEFIK_BASIC_AUTH=admin:$$apr1$$xyz...

# -----------------------------------------------------------------------------
# Application Version
# -----------------------------------------------------------------------------
CHIVE_VERSION=latest

# -----------------------------------------------------------------------------
# PostgreSQL Configuration
# -----------------------------------------------------------------------------
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=chive
POSTGRES_USER=chive
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE
# Full connection URL (used by application)
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
# Full connection URL
REDIS_URL=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}
REDIS_KEY_PREFIX=chive:

# -----------------------------------------------------------------------------
# Elasticsearch Configuration
# -----------------------------------------------------------------------------
ELASTICSEARCH_HOST=elasticsearch
ELASTICSEARCH_PORT=9200
ELASTICSEARCH_URL=http://${ELASTICSEARCH_HOST}:${ELASTICSEARCH_PORT}
# Leave empty for no auth (single-node dev setup)
ELASTICSEARCH_USER=
ELASTICSEARCH_PASSWORD=
ELASTICSEARCH_REQUEST_TIMEOUT=30000
ELASTICSEARCH_MAX_RETRIES=3
ELASTICSEARCH_MAX_CONNECTIONS=10

# -----------------------------------------------------------------------------
# Neo4j Configuration
# -----------------------------------------------------------------------------
NEO4J_HOST=neo4j
NEO4J_PORT=7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE
NEO4J_URI=bolt://${NEO4J_HOST}:${NEO4J_PORT}

# -----------------------------------------------------------------------------
# ATProto Configuration
# -----------------------------------------------------------------------------
# ATProto relay for firehose consumption
ATPROTO_RELAY_URL=wss://bsky.network
# Default PDS for user resolution
ATPROTO_PDS_URL=https://bsky.social
# Chive Governance PDS DID (for authority records)
CHIVE_GOVERNANCE_DID=did:plc:chive-governance

# -----------------------------------------------------------------------------
# Application Configuration
# -----------------------------------------------------------------------------
NODE_ENV=production
PORT=3000
LOG_LEVEL=info

# Rate limiting behavior when Redis is unavailable
# "open" = allow requests (fail open), "closed" = deny requests (fail closed)
RATE_LIMIT_FAIL_MODE=closed

# PDS staleness threshold (7 days in milliseconds)
STALENESS_THRESHOLD_MS=604800000

# -----------------------------------------------------------------------------
# Security - REQUIRED: Generate secure values for production
# -----------------------------------------------------------------------------
# JWT signing secret (generate with: openssl rand -base64 64)
JWT_SECRET=CHANGE_ME_GENERATE_SECURE_RANDOM_STRING

# Session secret (generate with: openssl rand -base64 64)
SESSION_SECRET=CHANGE_ME_GENERATE_SECURE_RANDOM_STRING

# -----------------------------------------------------------------------------
# OpenTelemetry Configuration (Backend Traces)
# -----------------------------------------------------------------------------
# These are set in docker-compose.prod.yml per-service, but can be overridden
OTEL_SERVICE_NAME=chive-appview
OTEL_SERVICE_VERSION=0.1.0
# Points to Grafana Alloy container (set in docker-compose)
# OTEL_EXPORTER_OTLP_ENDPOINT=http://alloy:4318

# -----------------------------------------------------------------------------
# Frontend Observability (Grafana Faro)
# -----------------------------------------------------------------------------
# Faro collector URL - the frontend sends telemetry here
# For self-hosted: https://faro.${DOMAIN}/collect
# For Grafana Cloud: https://faro-collector-prod-us-east-0.grafana.net/collect/<app-id>
NEXT_PUBLIC_FARO_URL=https://faro.${DOMAIN}/collect

# Application version (used for telemetry attribution)
# Typically set from CI: NEXT_PUBLIC_APP_VERSION=${GITHUB_SHA}
NEXT_PUBLIC_APP_VERSION=0.0.0

# Trace sampling rate (0.0 - 1.0)
# Production recommendation: 0.1 (10%) to manage costs
NEXT_PUBLIC_FARO_TRACE_SAMPLE_RATE=0.1

# Session sampling rate (0.0 - 1.0)
# Production recommendation: 0.5 (50%) for representative sampling
NEXT_PUBLIC_FARO_SESSION_SAMPLE_RATE=0.5

# -----------------------------------------------------------------------------
# External Services (Optional)
# -----------------------------------------------------------------------------
# ORCID OAuth credentials (for researcher authentication)
ORCID_CLIENT_ID=
ORCID_CLIENT_SECRET=

# DOI registration (for published eprints)
DOI_REGISTRATION_ENDPOINT=
DOI_PREFIX=
DOI_USERNAME=
DOI_PASSWORD=

# Blob storage/CDN (for caching blobs from user PDSes)
# S3-compatible storage (Backblaze B2, AWS S3, Cloudflare R2)
S3_ENDPOINT=
S3_BUCKET=
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_REGION=auto

# -----------------------------------------------------------------------------
# Observability Stack (enable with: docker compose --profile observability up)
# -----------------------------------------------------------------------------
# Grafana dashboard credentials
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_SECURE_PASSWORD

# Note: The observability stack includes:
# - Grafana Alloy (receives frontend Faro + backend OTLP)
# - Tempo (distributed tracing)
# - Loki (log aggregation)
# - Grafana (dashboards)
#
# Access points:
# - Grafana: https://grafana.${DOMAIN}
# - Faro collector: https://faro.${DOMAIN}/collect (for NEXT_PUBLIC_FARO_URL)
